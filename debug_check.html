<!DOCTYPE html>
<html>
<head>
    <title>Debug LocalStorage Check</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 20px 0; border: 1px solid #ccc; padding: 10px; }
        .title { font-weight: bold; color: #1890ff; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>HPLC LocalStorage Debug Tool</h1>
    
    <button onclick="checkAll()">æ£€æŸ¥æ‰€æœ‰æ•°æ®</button>
    <button onclick="clearConsole()">æ¸…ç©ºæ˜¾ç¤º</button>
    
    <div id="output"></div>

    <script>
        function clearConsole() {
            document.getElementById('output').innerHTML = '';
        }

        function checkAll() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            
            // æ£€æŸ¥ hplc_methods_raw
            checkData('hplc_methods_raw', 'Methodsé…ç½®æ•°æ®', output);
            
            // æ£€æŸ¥ hplc_gradient_data
            checkData('hplc_gradient_data', 'Gradientæ¢¯åº¦æ•°æ®', output);
            
            // æ£€æŸ¥ hplc_factors_data
            checkData('hplc_factors_data', 'Factorså› å­æ•°æ®', output);
        }

        function checkData(key, name, output) {
            const section = document.createElement('div');
            section.className = 'section';
            
            const title = document.createElement('div');
            title.className = 'title';
            title.textContent = `ğŸ“¦ ${name} (${key})`;
            section.appendChild(title);
            
            const dataStr = localStorage.getItem(key);
            
            if (!dataStr) {
                const error = document.createElement('div');
                error.className = 'error';
                error.textContent = 'âŒ ä¸å­˜åœ¨';
                section.appendChild(error);
            } else {
                const success = document.createElement('div');
                success.className = 'success';
                success.textContent = `âœ… å­˜åœ¨ (${dataStr.length} å­—ç¬¦)`;
                section.appendChild(success);
                
                try {
                    const data = JSON.parse(dataStr);
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(data, null, 2);
                    section.appendChild(pre);
                    
                    // ç‰¹æ®Šæ£€æŸ¥
                    if (key === 'hplc_gradient_data') {
                        const check = document.createElement('div');
                        check.innerHTML = `
                            <br/><b>å…³é”®å­—æ®µæ£€æŸ¥:</b><br/>
                            - calculations: ${!!data.calculations ? 'âœ…' : 'âŒ'}<br/>
                            - calculations.mobilePhaseA: ${!!data.calculations?.mobilePhaseA ? 'âœ…' : 'âŒ'}<br/>
                            - calculations.mobilePhaseB: ${!!data.calculations?.mobilePhaseB ? 'âœ…' : 'âŒ'}<br/>
                            - mobilePhaseA.components: ${data.calculations?.mobilePhaseA?.components?.length || 0} ä¸ª<br/>
                            - mobilePhaseB.components: ${data.calculations?.mobilePhaseB?.components?.length || 0} ä¸ª<br/>
                        `;
                        section.appendChild(check);
                    }
                    
                    if (key === 'hplc_methods_raw') {
                        const check = document.createElement('div');
                        check.innerHTML = `
                            <br/><b>å…³é”®å­—æ®µæ£€æŸ¥:</b><br/>
                            - mobilePhaseA: ${data.mobilePhaseA?.length || 0} ä¸ªè¯•å‰‚<br/>
                            - mobilePhaseB: ${data.mobilePhaseB?.length || 0} ä¸ªè¯•å‰‚<br/>
                            - preTreatmentReagents: ${data.preTreatmentReagents?.length || 0} ä¸ªè¯•å‰‚<br/>
                        `;
                        section.appendChild(check);
                    }
                } catch (e) {
                    const error = document.createElement('div');
                    error.className = 'error';
                    error.textContent = `âŒ JSONè§£æå¤±è´¥: ${e.message}`;
                    section.appendChild(error);
                }
            }
            
            output.appendChild(section);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = checkAll;
    </script>
</body>
</html>
