# HPLC 文件管理功能 - 用户使用指南

## 功能概述

HPLC绿色化学分析系统现在支持完整的文件保存和加载功能，您可以：
- 📁 **保存工作数据**到本地JSON文件
- 📂 **打开已保存的文件**继续编辑
- 💾 **自动跟踪数据变更**，提醒保存
- ⚠️ **关闭前提示**，避免数据丢失

## 使用说明

### 1. 首次保存数据

#### 步骤：
1. 在 **Methods** 页面配置您的实验方法
   - 输入样品数量
   - 添加前处理试剂
   - 配置流动相A和B的组成

2. 在 **Factors** 页面管理试剂参数
   - 使用预定义的试剂数据
   - 或添加自定义试剂

3. 点击左侧菜单 **File > Save File**
   - 系统会弹出"另存为"对话框
   - 选择保存位置（如：桌面、文档文件夹）
   - 输入文件名（如：`实验1_2025.json`）
   - 点击"保存"

4. 保存成功后：
   - Header右侧显示当前文件名
   - "未保存"标记消失

### 2. 后续保存（快速保存）

当您继续编辑数据时：

1. **系统自动检测数据变更**
   - Header右侧显示 "⚠ 未保存" 红色标记
   - File菜单的Save File项显示红色保存图标

2. **快速保存**
   - 点击 **File > Save File**
   - 系统**直接保存到原文件**（不会弹出对话框）
   - 保存成功后，"未保存"标记消失

💡 **提示**：您可以随时快速按 Ctrl+S 的习惯点击Save File进行保存

### 3. 打开已有文件

#### 步骤：
1. 点击 **File > Open File**

2. 如果当前有未保存的数据：
   - 系统会弹出确认对话框
   - 选择"保存"：先保存当前数据再打开文件
   - 选择"不保存"：直接打开文件，当前数据会丢失

3. 在文件选择对话框中选择之前保存的JSON文件

4. 文件加载成功后：
   - 所有页面自动显示加载的数据
   - Methods页面显示保存的实验参数
   - Factors页面显示保存的试剂数据
   - Header显示文件名

### 4. 另存为新文件

如果您想：
- 基于当前配置创建一个新的实验方案
- 保存数据的一个副本

#### 步骤：
1. 点击 **File > Save As...**
2. 在对话框中选择新的保存位置
3. 输入新的文件名
4. 点击"保存"

系统会：
- 创建一个新文件
- 后续的Save File操作会保存到这个新文件

### 5. 创建新文件

开始一个全新的实验配置：

1. 点击 **File > New File**

2. 如果当前有未保存的数据：
   - 系统会提示您保存
   - 选择"保存"或"不保存"

3. 系统清空所有数据：
   - Methods恢复默认值
   - Factors恢复预定义数据
   - 当前文件名清除

4. 您可以开始配置新的实验方案

### 6. 关闭系统前的保存提示

当您尝试关闭浏览器标签页或窗口时：

- **如果有未保存的数据**（显示"未保存"标记）
  - 浏览器会弹出标准确认对话框
  - "确定要离开吗？您的更改可能不会保存"
  - 点击"取消"返回页面保存数据
  - 点击"离开"关闭页面（数据会丢失）

- **如果没有未保存的数据**
  - 直接关闭，无提示

## 数据文件格式

保存的文件是标准的JSON格式，包含：
- `version`: 数据格式版本
- `lastModified`: 最后修改时间
- `methods`: Methods页面的所有配置
- `factors`: Factors页面的试剂数据
- `gradient`: HPLC梯度数据（未来版本）

示例文件内容：
```json
{
  "version": "1.0.0",
  "lastModified": "2025-01-08T12:00:00.000Z",
  "methods": {
    "sampleCount": 10,
    "preTreatmentReagents": [...],
    "mobilePhaseA": [...],
    "mobilePhaseB": [...]
  },
  "factors": [...]
}
```

## 常见问题

### Q: 保存的文件可以在其他电脑上使用吗？
A: 可以！您可以将JSON文件复制到任何电脑，在HPLC系统中打开。

### Q: 我忘记保存就关闭了页面，数据还能恢复吗？
A: 系统会在localStorage中保留最近的数据，重新打开系统时可能还能看到。但建议养成及时保存的习惯。

### Q: 为什么有时候点Save File会弹对话框，有时候不会？
A: 
- **首次保存**：需要选择保存位置，会弹出对话框
- **后续保存**：系统记住了文件位置，直接保存，不弹对话框
- **使用另存为**：总是会弹出对话框

### Q: 文件格式可以改成Excel吗？
A: 当前版本只支持JSON格式。如需要Excel，可以在Table页面查看数据并手动复制。

### Q: 我可以编辑保存的JSON文件吗？
A: 理论上可以，但不建议。JSON格式对语法要求严格，手动编辑容易出错。建议通过系统界面修改数据。

## 浏览器兼容性

✅ **完全支持**：
- Google Chrome 86+
- Microsoft Edge 86+

⚠️ **部分支持**：
- Firefox（可能需要手动下载/上传文件）
- Safari（可能需要手动下载/上传文件）

建议使用Chrome或Edge浏览器以获得最佳体验。

## 数据安全提示

1. **定期备份**：重要数据请定期备份到不同位置
2. **文件命名**：使用有意义的文件名，如：`实验名称_日期.json`
3. **及时保存**：养成频繁保存的习惯
4. **版本管理**：重要实验可以保存多个版本

## 快捷操作建议

- 📝 **配置时**：随时点击Save File保存进度
- 🔄 **修改后**：注意Header的"未保存"提示
- 🗂️ **实验多**：为每个实验创建独立的文件
- 📊 **分析前**：先保存当前配置，以便后续对比
